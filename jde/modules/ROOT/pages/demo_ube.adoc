=  Submitting a UBE Batch Process
:keywords: add_keywords_separated_by_commas
:imagesdir: images
:toc: macro
:toclevels: 2


The following guide explains how to submit a batch process on the JD Edwards EnterpriseOne™ server.

== Getting Started

* Review the xref:jde-requirements.adoc[PortX JDE Connector Reqirements].
* Review the xref:jde-preliminary-setup.adoc[PortX JDE Connector Preliminary Setup].
* See the link:/https://docs.oracle.com/cd/E64610_01/EOADI/title.htm[JD Edwards EnterpriseOne Applications Data Interface for Electronic Data Interchange Implementation Guide] for more information about requirements.
* A basic understanding of Oracle’s JD Edwards EnterpriseOne™, Mule, the and the https://docs.mulesoft.com/anypoint-studio/v/6/download-and-launch-anypoint-studio[Anypoint™ Studio] interface is assumed.


== Creating a New Mule Project 
To submit a UBE Batch Job/Report, begin with a new Mule Project.

. Login to your Mule Application
. Create a new Mule Project.
. Select *Mule Server 4.1.1 EE* or greater as runtime.

image:demo_ube/image1_demo_ube.png[image,width=321,height=423]

=== Project Dependencies

. In your *pom.xml*, add the following to you *repositories* section.
[source,xml]
----
<repository>
    <id>portx-repository-releases</id>
    <name>portx-repository-releases</name>
    <url>https://portx.jfrog.io/portx/portx-releases</url>
</repository>
----
[start=2]

. Add the following to your *dependencies* section.

[source,xml]
----
<dependency>
<groupId>com.modus</groupId>
    <artifactId>mule-jde-connector</artifactId>
    <version>2.0.0</version>
    <classifier>mule-plugin</classifier>
</dependency>
<dependency>
    <groupId>com.jdedwards</groupId>
    <artifactId>jde-lib-bundle</artifactId>
    <version>1.0.0</version>
    <classifier>mule-4</classifier>
</dependency>
----
[start=3]

. Add or update the following to your *plugins* section.

[source,xml]
----
<plugin>
    <groupId>org.mule.tools.maven</groupId>
    <artifactId>mule-maven-plugin</artifactId>
    <version>$\{mule.maven.plugin.version}</version>
    <extensions>true</extensions>
    <configuration>
        <sharedLibraries>
            <sharedLibrary>
                <groupId>com.jdedwards</groupId>
                <artifactId>jde-lib-bundle</artifactId>
            </sharedLibrary>
        </sharedLibraries>
    </configuration>
</plugin>
----
=== Required files
Complete the following actions:

. Copy the JD Edwards EntrpriseOne™ configuration files to the following folders within your project:

* Project *Root*
* *src/main/resources*

NOTE: If you require different configuration files per environment, you may create separate folders under *src/main/resources* corresponding to each environment as shown below.

image:demo_ube/image2_demo_ube.png[image,width=250,height=446]
[start=2]

. Update the *mule-arifact.json* file per environment as shown below.

[source,json]
----
{
	"minMuleVersion": "4.1.4",
	"classLoaderModelLoaderDescriptor": {
		"id": "mule",
		"attributes": {
			"exportedResources": [
				"JDV920/jdeinterop.ini",
				"JDV920/jdbj.ini",
				"JDV920/tnsnames.ora",
				"JPY920/jdeinterop.ini",
				"JPY920/jdbj.ini",
				"JPY920/tnsnames.ora",
				"jdelog.properties",
				"log4j2.xml"
			],
			"exportedPackages": [
				"JDV920",
				"JPY920"
			],
			"includeTestDependencies": "true"
		}
	}
}
----

=== Other Considerations

To redirect the JD Edwards EntrpriseOne™ Logger to the Mule Logger (allowing you to see JDE activity in both your Console and the JDE files defined in the *jdelog.properties*), you may add the following *Async Loggers* to the *log4j2.xml* file.

[source,xml]
----
<!-- JDE Connector wire logging -->
<AsyncLogger name="org.mule.modules.jde.handle.MuleHandler" level="INFO" />
<AsyncLogger name="org.mule.modules.jde.JDEConnector" level="INFO" />
----
=== Troubleshooting

If you are experiencing trouble resolving all dependencies:

. Shut down AnyPoint Studio.
. Run the following command in the project *ROOT* folder from the terminal/command prompt.
[source]
mvn clean install

[start=3]
. Open AnyPoint Studio and check dependencies again.

=== Configure the Global Element
include::{partialsdir}/configure-global-element.adoc[]


=== Creating an HTTP Listener for Your Flow

To submit a batch/job process, you must create a simple flow to submit a job for *UBE R0008P_XJDE0001* on Oracle’s JDE EnterpriseOne server.

. In your Anypoint Studio project, go to the *Message Flow* tab.

image:demo_ube/image8_demo_ube.png[image,width=615,height=459]

[start=2]

. From the Mule Palette (top right), select *HTTP*, and drag *Listener* to your canvas.

image:demo_ube/image9_demo_ube.png[image,width=263,height=286]

[start=3]

. Select the *HTTP Listener* component from your canvas and inspect the *Properties* window.
+
The Properties window appears.

image:demo_ube/image10_demo_ube.png[image,width=655,height=390]

[start=4]
. Click *Add* to create a connector configuration.
+
The Global Element Properties window appears.

image:demo_ube/image11_demo_ube.png[image,width=415,height=420]

[start=5]
. Under the *General* tab, give the *HTTP Endpoint* a more descriptive name (eg: get-submitR0008P-http-endpoint).


. Click *OK*.
+
The Properties Window appears.
[start=7]

. Add a path to the URL (eg. submit R0008P_XJDE0001.).

image:demo_ube/image12_demo_ube.png[image,width=601,height=252]

[start=8]

. Save your project. 
+
The connector is ready to process requests.

=== Submit a Batch Process

. In your Mule Pallet, locate the *JDE* Connector.
. Select *Submit batch process*.
. Drag it to your canvas.

image:demo_ube/image13_demo_ube.png[image,width=331,height=232]

[start=4]
. Select the connector and review the *Properties* window.
+
The Properties window appears.

image:demo_ube/image14_demo_ube.png[image,width=601,height=253]

[start=5]
. Give the connector a meaningful name (eg. Submit R0008P_XJDE0001).
. Under the *General* section, click the drop-down for *UBE Name*.
. Type in the *Batch Job* and *Version* you want to call in the *BatchJob Version* format (eg. *R0008P_XJDE0001*).

NOTE: If this the first time you are selecting a *UBE*, the process  may take some time, as no information has been cached yet. The status bar (bottom right) displays the following image while it's retrieving the metadata.

image:demo_ube/image15_demo_ube.png[image,width=307,height=30]

=== Troubleshooting
If the operation fails (possibly due to a timeout), the following message appears.

image:demo_ube/troubleshoot_timeout_message.png[image,width=345,height=115]

. Go the *Window > Preferences* menu.

image:demo_ube/troubleshoot_preferences_menu.png[image,width=154,height=199]

The Preferences window appears.
[start=2]

. Go to *Anypoint Studio > DataSense* and change the *DataSense Connection Timeout* setting as demonstrated below.

image:demo_ube/troubleshoot_datasense_timeout.png[image,width=622,height=551]

[start=3]

. Go to *Anypoint Studio > Tooling* and change the *Default Connection Timeout*  and *Default Read Timeout* settings as demonstrated below.

image:demo_ube/troubleshoot_timeout_tooling.png[image,width=622,height=551]

=== Setting Parameters
After your system has retrieved the required metadata set your paramaters.

. Select *R0008P_XJDE0001*. 
+
The specification metadata is retrieved from the enterprise server, and put into your project metadata repository.

image:demo_ube/image12_demo_ube.png[image,width=601,height=252]

==== *Assign Input Parameters*
[start=2]
. Enter the *Payload* values manually, or via the *Show Graphical View* button, as demonstrated below.

image:demo_ube/image16_demo_ube.png[image,width=586,height=225]

[start=3]

. Drag the inputs to outputs or double-click the output parameter to add to your edit window and change as required. 

Example:

* *_Job Queue* : Enter the Job Queue or leave it blank for the default job queue.

* *_Selection* : F0010.CO = ''00000'' (See xref:jde-appendix-a.adoc#how-define-data-selection[Appendix A] for data selection details)

* *cFiscalDatePattern* : F

image:demo_ube/image17_demo_ube.png[image,width=601,height=218]

=== Set Payload Output

. In the Mule Palette either select *Core* and scroll down to *Transformers*, or type *Payload* in the search bar.

image:demo_ube/image18_demo_ube.png[image,width=325,height=246]

[start=2]

. Drag and drop the *Set Payload* to your canvas.

image:demo_ube/image19_demo_ube.png[image,width=280,height=262]

[start=3]

. Select the *Set Payload* component and review the *Properties*.

image:demo_ube/image20_demo_ube.png[image,width=601,height=157]

[start=4]

. Change the payload to reflect the desired output and save the project.

image:demo_ube/image21_demo_ube.png[image,width=601,height=174]

=== Testing the Mule Flow

To ensure your connector is working properly, test your mule flow.

. Start your Mule application.

. Go to the *Run* menu and select *Run*.

image:demo_ube/image22_demo_ube.png[image,width=461,height=305]

Once your project is deployed, you can test you flow by typing the URL into a web browser (eg. *http://localhost:8081/submitR0008P_XJDE0001*).

image:demo_ube/image23_demo_ube.png[image,width=403,height=126]

[start=3]

. Log into JD Edwards EnterpriseOne and *View Job Status* for the user specified in the global element (eg. JDE).

image:demo_ube/image24_demo_ube.png[image,width=601,height=125]

=== Handling Exceptions

. From your Mule Pallete, select and drag the *Error Handler* to your canvas. 

image:demo_ube/image25_demo_ube.png[image,width=261,height=336]image:demo_ube/image26_demo_ube.png[image,width=294,height=335]

[start=2]

. Select and drag *On Error Continue* into the *Error Handler*.

image:demo_ube/image27_demo_ube.png[image,width=220,height=118]

[start=3]

. Select the *On Error Continue* scope and under *Type* enter:

*JDE:ERROR_SUBMITTING_UBE*

image:demo_ube/image28_demo_ube.png[image,width=529,height=253]

NOTE: Operation error types are viewable when selecting the operation on your canvas, going to *Error Mapping*, and clicking *Add*. You may also map this error to an application specific error.

image:demo_ube/image29_demo_ube.png[image,width=231,height=268]

[start=4]

. Drag the *Set Payload* component to the *Error Handler* and set an appropriate message.

image:demo_ube/image30_demo_ube.png[image,width=506,height=202]

=== Defining Data Selection

* The *parameter* Selection is used to define *UBE Data Selection*.
* The *sentence* is similar to a *WHERE* clause of an *SQL* statement.
* The *Selection* syntax is:
** *table.column_name* operator [value|table.column_name];
* The table must be a *JDE* table that belongs to the main view of the *UBE*.
* *Column Name* must be a *JDE Data Item Alias*.
* The following operators can be used in the *Selection* :

[cols=",",options="header",]
|===
|Operator |Description
|= |Equal
|<> |Not equal
|<> |Not equal
|> |Greater than
|< |Less than
|>= |Greater than or equal
|⇐ |Less than or equal
|BETWEEN |Between an inclusive range
|NOT BETWEEN |Not Between an exclusive range
|IN |To specify multiple possible values for a column
|NOT IN |To exclude multiple possible values for a column
|===

* The values can be *literals* or other *table columns*.
* *Literals* can be *String or Number*.
* The *sentence* can include the *AND and/or* the *OR* conditions
* To override the *default precedence*, you need to use parenthesis as
** *C1 AND (C2 OR C3)*
** The sentence only accepts one level of Parenthesis.

Examples:

* Valid Sentence (maximum level of Parenthesis opened is 1).

** C1 AND (C2 OR C3) AND (C4 OR C5)

* Invalid Sentence (maximum level of Parenthesis opened is 2).

** C1 AND (C2 OR (C3 AND C4))

Use case examples:

[source,sql]
----
F4211.KCOO = '00001' AND F4211.DOCO > 10332
F4211.KCOO = '00001' AND F4211.DOCO >= 10332
F4211.KCOO = '00001' AND F4211.DOCO <= 10332
F4211.KCOO = '00001' AND F4211.DOCO <> 10332
F4211.KCOO = '00001' AND ( F4211.DCTO = 'SO' OR F4211.DCTO = 'SI' )
F4211.KCOO = '00001' AND F4211.DCTO IN ('SO','SI')
F4211.KCOO = '00001' AND F4211.DCTO NOT IN ('SO','SI')
F4211.KCOO = '00001' AND F4211.DOCO BETWEEN 1022 AND 400
F4211.KCOO = '00001' AND F4211.DOCO NOT BETWEEN 1022 AND 400
F4211.MCU = F4211.EMCU AND F4211.DOCO NOT BETWEEN 1022 AND 400
----
