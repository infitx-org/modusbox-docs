= AnyPoint Studio Project

This user guide provides instructions to accomplish the following:

* <<Create a New Mule Project>>
* <<Configure the Global Element>>
* <<Invoke Business Functions>>
* <<Testing the Mule Flow>>

NOTE: Update AnyPoint Studio before starting with a PortX JDE Connector project.

== Create a New Mule Project 
. Open Anypoint Studio.
. Create a new Mule Project.
. Name the project appropritely.
. Select *Mule Server 4.1.1 EE* or greater as runtime.

image:demo_getting_started/image2_getting_started.png[image,width=321,height=423]
[start=5]
. Click *Finish*.

=== Project Dependencies

. In your *pom.xml* add the following to your *Repositories* section.
[source,xml]

----
<repository>
    <id>portx-repository-releases</id>
    <name>portx-repository-releases</name>
    <url>https://portx.jfrog.io/portx/portx-releases</url>
</repository>
----
[start=2]

. Add the following to your *Dependencies* section.

[source,xml]
----
<dependency>
<groupId>com.modus</groupId>
    <artifactId>mule-jde-connector</artifactId>
    <version>2.0.0</version>
    <classifier>mule-plugin</classifier>
</dependency>
<dependency>
    <groupId>com.jdedwards</groupId>
    <artifactId>jde-lib-bundle</artifactId>
    <version>1.0.0</version>
    <classifier>mule-4</classifier>
</dependency>
----
[start=3]

. Add or update the following to your *Plugins* section.

[source,xml]
----
<plugin>
    <groupId>org.mule.tools.maven</groupId>
    <artifactId>mule-maven-plugin</artifactId>
    <version>$\{mule.maven.plugin.version}</version>
    <extensions>true</extensions>
    <configuration>
        <sharedLibraries>
            <sharedLibrary>
                <groupId>com.jdedwards</groupId>
                <artifactId>jde-lib-bundle</artifactId>
            </sharedLibrary>
        </sharedLibraries>
    </configuration>
</plugin>
----

=== Required files
. Copy the _JD Edwards EntrpriseOne™_ configuration files to the following folders within the project:

* Project *Root*
* *src/main/resources*

NOTE: If there is a requirement to use different configuration files per environment, you may create separate folders under *src/main/resources* corresponding to each environment as shown below.

image:demo_getting_started/image3_getting_started.png[image,width=250,height=446]

[start=2]

. Update the *mule-artifact.json* file for each environment, as shown below.

[source,json]
----
{
	"minMuleVersion": "4.1.4",
	"classLoaderModelLoaderDescriptor": {
		"id": "mule",
		"attributes": {
			"exportedResources": [
				"JDV920/jdeinterop.ini",
				"JDV920/jdbj.ini",
				"JDV920/tnsnames.ora",
				"JPY920/jdeinterop.ini",
				"JPY920/jdbj.ini",
				"JPY920/tnsnames.ora",
				"jdelog.properties",				
				"log4j2.xml"
			],
			"exportedPackages": [
				"JDV920",
				"JPY920"
			],
			"includeTestDependencies": "true"
		}
	}
}
----

=== Other Considerations

To redirect the JD Edwards EntrpriseOne™ Logger to the Mule Logger (allowing you to see the JDE activity in both Console and JDE files defined in the *jdelog.properties*), you may add the following *Async Loggers* to *log4j2.xml* file.
[source,xml]
----
<AsyncLogger name="org.mule.modules.jde.internal.JDEConnector" level="DEBUG" />
<AsyncLogger name="org.mule.modules.jde.api.MuleHandler" level="DEBUG" />
----
=== Troubleshooting

If you experience trouble resolving all dependencies:

. Shut down AnyPoint Studio
. Run the following command in the project ROOT folder from the terminal/command prompt,
[source]
mvn clean install

[start=3]
. Open AnyPoint Studio and check dependencies again.

== Configure the Global Element

To use the PortX JDE Connector in your Mule application, configure a global element that can be used by the connector.

. Open the Mule flow for your project.
. Select the *Global Elements* tab at the bottom of the Editor Window.


image:demo_getting_started/image4_getting_started.png[image,width=515,height=273]

The Global Elements Page Appears.
[start=3]
. Click *Create*.

image:demo_getting_started/image5_getting_started.png[image,width=511,height=312]

The Choose Global Type Page appears.
[start=4]
. Type *JDE* in the filter edit box and select *JDE Config*. 
. Click *OK*.

image:demo_getting_started/image6_getting_started.png[image,width=386,height=390]

The JDE  Config Page Appears.
[start=6]

. On the *General* tab, enter the required *Credentials* and *Environment*.

image:demo_getting_started/image7_getting_started.png[image,width=378,height=383]

[start=7]
. Click *Test Connection*.

The following message appears.

image:demo_getting_started/image8_getting_started.png[image,width=513,height=135]

== Creating a HTTP Listener for Your Flow

This procedure shows how to create a simple flow to get the address book name from the *Address Book table (A/B)*, invoking the *Master Business Function (MBF)* on Oracle’s JDE EnterpriseOne™ Server.

. Go back to the *Message Flow* tab. 

image:demo_getting_started/image9_getting_started.png[image,width=615,height=459]

[start=2]

. From the Mule Palette (top right), select *HTTP*, and drag *Listener* to the canvas.

image:demo_getting_started/image10_getting_started.png[image,width=263,height=286]
[start=3]

. Select the *HTTP Listener* component from the canvas and inspect the *Properties* window.
+
The Global Element Properties window appears.

[start=4]
. Under Basic Settings, click the *Green Plus Sign* (add) to create a Connector Configuration.
+
The HTTP Listener Config page appears.

[start=5]
. Give the *HTTP endpoint* a more descriptive name (eg: *get-AddressBookName-http-endpoint*) 

image:demo_getting_started/image11_getting_started.png[image,width=655,height=390]

[start=6]
. Click *OK* to go back to the global HTTP endpoint dialog box.

image:demo_getting_started/image12_getting_started.png[image,width=436,height=441]
[start=7]

The Global HTTP endpoint dialog box appears.

[start=8]
. Add a path to the URL (eg. *getaddressbookname*).

image:demo_getting_started/image13_getting_started.png[image,width=641,height=346]

[start=9]

. Click the *MIME Type* tab on the left hand navagation pane.
. Add a parameter for *addressno*.

image:demo_getting_started/image14_getting_started.png[image,width=601,height=229]

[start=10]

. Save your project. 

The connector is ready to process requests.

== Invoke Business Functions

. Locate the *JDE* Connector and select *Call BSFN*.
. Drag this to the canvas.

image:demo_getting_started/image15_getting_started.png[image,width=332,height=236]


[start=3]

. Drag the connector over to the canvas.
. Select it and review the *Properties* window.
. Give it a meaningful name (eg. Call *AddressBookMasterMBF*).

. Under *General*, click on the drop-down for *Business Function Name*.

image:demo_getting_started/image16_getting_started.png[image,width=601,height=305]

NOTE: If this is your first instance selecting a function, this process may take some time, as no information has been cached yet. Please be patient while the system builds a list of all available functions. 

The status bar (bottom right) displays the following image while retrieving the metadata.

image:demo_getting_started/image17_getting_started.png[image,width=307,height=30]


=== Troubleshooting
If the operation fails (possibly due to a timeout), the following message appears.

image:demo_getting_started/troubleshoot_timeout_message.png[image,width=345,height=115]

Review the timeout settings in _Anypoint Studio_'s *Preferences*.


. Go the *Window > Preferences* menu.

image:demo_getting_started/troubleshoot_preferences_menu.png[image,width=154,height=199]

 
The preferences page appears.
[start=2]
. Go to *Anypoint Studio > DataSense* and change the *DataSense Connection Timeout* setting as demonstrated below.

image:demo_getting_started/troubleshoot_datasense_timeout.png[image,width=622,height=551]
[start=3]

. Go to *Anypoint Studio > Tooling* and change the *Default Connection Timeout* and *Default Read Timeout* settings as demonstrated below.

image:demo_getting_started/troubleshoot_timeout_tooling.png[image,width=622,height=551]

=== Setting Parameters

After the system has retrieved the required metadata:

. Select *AddressBookMasterMBF* from the *General Settings* dropdown list.
+
The specification metadata is retrieved from the enterprise server, and put into the project metadata repository.

image:demo_getting_started/image18_getting_started.png[image,width=601,height=283]
[start=2]
. Assign the _Input Parameters_ by entering the payload values manually, or by clicking the *Show Graphical View* button.

image:demo_getting_started/image19_getting_started.png[image,width=601,height=283]
[start=3]

. Drag the inputs to outputs, or double-click the output parameter to add to your edit window.

NOTE: Be sure to map your query parameter to the function *mnAddressBookNumber*.


image:demo_getting_started/image20_getting_started.png[image,width=601,height=271]

=== Set Payload Output

. In the Mule Palette, either select *Core* and scroll down to *Transformers*, or type *Payload* in the Search Bar.

image:demo_getting_started/image21_getting_started.png[image,width=325,height=246]
[start=2]

. Drag and drop the *Set Payload* to your canvas.

image:demo_getting_started/image22_getting_started.png[image,width=332,height=211]

[start=3]

. Select the *Set Payload* component and review the *Properties*.

image:demo_getting_started/image23_getting_started.png[image,width=601,height=157]
[start=4]

. Change the payload to reflect your desired output.
. Save your project.

image:demo_getting_started/image24_getting_started.png[image,width=601,height=178]

== Testing the Mule Flow

To test your flow, start your Mule Application.

. Go to the *Run* menu, and select *Run*.

image:demo_getting_started/image25_getting_started.png[image,width=567,height=376]

[start=2]

. After the project has been deployed, test your flow by typing the URL into a web browser (eg: http://localhost:8081/getaddressbookname?addressno=1).

image:demo_getting_started/image26_getting_started.png[image,width=601,height=88]

