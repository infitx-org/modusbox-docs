= Retrieve a UBE Batch Process Status
:keywords: add_keywords_separated_by_commas
:imagesdir: images
:toc: macro
:toclevels: 2

== Introduction


This guide explains how to retrieve a Batch Process Status from the server by passing it a job ID.

== Getting Started
* Review the PortX JDE Connector xref:jde-requirements.adoc[Reqirements].
* Review the PortX JDE Connector xref:jde-preliminary-setup.adoc[Preliminary Setup].
* See the link:/https://docs.oracle.com/cd/E64610_01/EOADI/title.htm[JD Edwards EnterpriseOne Applications Data Interface for Electronic Data Interchange Implementation Guide] for more information about requirements.
* A basic understanding of Oracle’s JD Edwards EnterpriseOne™, Mule, the and the https://docs.mulesoft.com/anypoint-studio/v/6/download-and-launch-anypoint-studio[Anypoint™ Studio] interface is assumed.

NOTE:  Update AnyPoint Studio before starting a PortX JDE Connector project.

=== Creating a New Mule Project
To retrieve a UBE Batch Process Status, begin with a new Mule Project.

. Login to your Mule Application
. Create a new Mule Project.
. Select *Mule Server 4.1.1 EE* or greater as runtime.

image:demo_ube_status/image1_demo_ube_status.png[image,width=321,height=423]

=== Project Dependencies

. In your *pom.xml*, add the following to you *Repositories* section:
[source,xml]
----
<repository>
    <id>portx-repository-releases</id>
    <name>portx-repository-releases</name>
    <url>https://portx.jfrog.io/portx/portx-releases</url>
</repository>
----

[start=2]

. Add the following to you *Dependencies* section:

[source,xml]
----
<dependency>
<groupId>com.modus</groupId>
    <artifactId>mule-jde-connector</artifactId>
    <version>2.0.0</version>
    <classifier>mule-plugin</classifier>
</dependency>
<dependency>
    <groupId>com.jdedwards</groupId>
    <artifactId>jde-lib-bundle</artifactId>
    <version>1.0.0</version>
    <classifier>mule-4</classifier>
</dependency>
----
[start=3]

. Add or update the following to you *Plugins* section:
[source,xml]
----
<plugin>
    <groupId>org.mule.tools.maven</groupId>
    <artifactId>mule-maven-plugin</artifactId>
    <version>$\{mule.maven.plugin.version}</version>
    <extensions>true</extensions>
    <configuration>
        <sharedLibraries>
            <sharedLibrary>
                <groupId>com.jdedwards</groupId>
                <artifactId>jde-lib-bundle</artifactId>
            </sharedLibrary>
        </sharedLibraries>
    </configuration>
</plugin>
----
=== Required files
Complete the following actions:

. Copy the JD Edwards EntrpriseOne™ configuration files to the following folders within your project:

* Project *Root*
* *src/main/resources*

NOTE: If you are required to use different configuration files per environment, you may create separate folders under *src/main/resources* corresponding to each environment as shown below.

image:demo_ube_status/image2_demo_ube_status.png[image,width=250,height=446]

[start=2]
. Update the *mule-arifact.json* file per environment as shown below.

[source,json]
----
{
	"minMuleVersion": "4.1.4",
	"classLoaderModelLoaderDescriptor": {
		"id": "mule",
		"attributes": {
			"exportedResources": [
				"JDV920/jdeinterop.ini",
				"JDV920/jdbj.ini",
				"JDV920/tnsnames.ora",
				"JPY920/jdeinterop.ini",
				"JPY920/jdbj.ini",
				"JPY920/tnsnames.ora",
				"jdelog.properties",
				"log4j2.xml"
			],
			"exportedPackages": [
				"JDV920",
				"JPY920"
			],
			"includeTestDependencies": "true"
		}
	}
}
----
=== Other Considerations

To redirect the JD Edwards EntrpriseOne™ Logger to the Mule Logger (allowing you to see the JDE activity in both Console and JDE files defined in the *jdelog.properties*), you may add the following *Async Loggers* to the *log4j2.xml* file.
[source,xml]
----
_<!-- JDE Connector wire logging -->_
<AsyncLogger name="org.mule.modules.jde.handle.MuleHandler" level="INFO" />
<AsyncLogger name="org.mule.modules.jde.JDEConnector" level="INFO" />
----
=== Troubleshooting

If you are having trouble resolving all dependencies:

. Shut down AnyPoint Studio.
. Run the following command in the project *Root* folder from the terminal/command prompt.
[source]
mvn clean install

[start=3]
. Open AnyPoint Studio and check dependencies again.

=== Configure the Global Element
include::{partialsdir}/configure-global-element.adoc[]

=== Creating an HTTP Listener for Your Flow

To retrieve a UBE Batch Process Status, you must create a simple flow for *UBE R000P_XJDE0001* on Oracle’s JDE EnterpriseOne server.

. Log into your JDE EnterpriseOne and navigate to *Submitted Jobs*.
+
The Submitted Job Search Page appears.
. Find a previously submitted job for *ube R0008P*, *Version XJDE0001*, and note the *Job Number* (*248* in this case).

image:demo_ube_status/image8_demo_ube_status.png[image,width=601,height=133]

NOTE: See <<demo_ube.adoc#,Submitting a UBE Batch Process>>  for details on how to submit this report from a flow.

[start=3]

. Go back and select the *Message Flow* tab.

image:demo_ube_status/image9_demo_ube_status.png[image,width=615,height=459]

[start=4]

. From the Mule Palette (top right), select *HTTP*, and drag *Listener* to your canvas.

image:demo_ube_status/image10_demo_ube_status.png[image,width=263,height=286]

[start=5]

. Select the *HTTP Listener* component from your canvas and inspect the *Properties* window.
+
The Properties window appears.
image:demo_ube_status/image11_demo_ube_status.png[image,width=655,height=390]

[start=6]

. Click *Add* to create a connector configuration.
. Give the *HTTP* endpoint a more descriptive name (eg. *get-ubestatus-http-endpoint*).
. Click *OK* to go back to the global HTTP endpoint dialog box.

image:demo_ube_status/image12_demo_ube_status.png[image,width=404,height=410]
[start=9]

. Under *General*, add a path to the URL (eg. *getubestatus*)

image:demo_ube_status/image13_demo_ube_status.png[image,width=601,height=223]

[start=10]

. Select *Mime Type* on the left, and add a parameter for *Job Number*.

image:demo_ube_status/image14_demo_ube_status.png[image,width=601,height=234]

[start=11]

. Save the project. 

The connector is ready to process requests.

== Retrieve a UBE Status

. In your Mule Pallet locate the JDE Connector.
. Select *Get Batch Process Information*.
. Drag it to your canvas.

image:demo_ube_status/image15_demo_ube_status.png[image,width=378,height=234]

[start=3]

. Drag the JDE Connector over to your canvas. 
. Select the JDE Connector and review the *Properties* window.
+
The Properties window appears.

image:demo_ube_status/image16_demo_ube_status.png[image,width=463,height=229]
[start=5]

. Under the *General* section, click on the drop-down for *UBE Name / Operation*.

image:demo_ube_status/image17_demo_ube_status.png[image,width=460,height=228]

You may now assign the input parameters.

[start=6]

. Enter the *payload values* manually, or via the *Show Graphical View* button.

image:demo_ube_status/image18_demo_ube_status.png[image,width=601,height=231]

[start=7]

. Map the query parameter *jobnumber* to the *Job ID* input parameter and click *Done*.

image:demo_ube_status/image19_demo_ube_status.png[image,width=550,height=264]

=== Troubleshooting
If the operation fails (possibly due to a timeout), the following message appears.

image:demo_ube_status/troubleshoot_timeout_message.png[image,width=345,height=115]

Review the Timeout Settings in _Anypoint Studio_ *Preferences*.

. Go the *Window > Preferences* menu.

image:demo_ube_status/troubleshoot_preferences_menu.png[image,width=154,height=199]

[start=2]

. Go to *Anypoint Studio > DataSense* and change the *DataSense Connection Timeout* setting as demonstrated below.

image:demo_ube_status/troubleshoot_datasense_timeout.png[image,width=622,height=551]

[start=3]

. Go to *Anypoint Studio > Tooling* and change the *Default Connection Timeout* and *Default Read Timeout* settings as demonstrated below.

image:demo_ube_status/troubleshoot_timeout_tooling.png[image,width=622,height=551]

=== Set Payload Output

. In the Mule Palette, either select *Core*, scroll down to *Transformers* or type *Payload* in the search bar.

image:demo_ube_status/image20_demo_ube_status.png[image,width=325,height=246]

[start=2]

. Drag and drop the *Set Payload* to your canvas.

image:demo_ube_status/image21_demo_ube_status.png[image,width=354,height=319]

[start=3]

. Select the *Set Payload* component and review the *Properties*.
. Click *Show Graphical View*.

image:demo_ube_status/image22_demo_ube_status.png[image,width=556,height=145]

[start=5]

. Change the *Payload* to reflect the desired output and save the project

image:demo_ube_status/image23_demo_ube_status.png[image,width=559,height=134]

=== Testing the Mule Flow

To Test your flow, start the Mule application.

. Go to the *Run Menu* and select *Run*.

image:demo_ube_status/image24_demo_ube_status.png[image,width=461,height=305]

[start=2]

. Once the project is deployed, test you flow by typing the *URL* into a web browser (eg. http://localhost:8081/getubestatus).

image:demo_ube_status/image25_demo_ube_status.png[image,width=403,height=126]

=== Handling exceptions

. From your Mule Pallete select and drag the *Error Handler* to your canvas

image:demo_ube_status/image26_demo_ube_status.png[image,width=267,height=334]image:demo_ube_status/image27_demo_ube_status.png[image,width=294,height=335]

[start=2]

. Now select and drag the *On Error Continue* into the *Error Handler*.

image:demo_ube_status/image28_demo_ube_status.png[image,width=245,height=128]

[start=3]

. Select the *On Error Continue* scope.
. Under *Type* enter *_JDE:ERROR_GETTING_JOB_STATUS_*.

image:demo_ube_status/image29_demo_ube_status.png[image,width=601,height=247]

NOTE: The operation error types are visable when selecting the operation on your canvas, going to *Error Mapping*, and clicking add. You may also map this error to a application specific error.

image:demo_ube_status/image30_demo_ube_status.png[image,width=258,height=301]

[start=5]

. Drag the *Set Payload* component to the *Error Handler*, and set an appropriate message.

image:demo_ube_status/image31_demo_ube_status.png[image,width=506,height=202]