= PortX JD Edwards Connector for Mule 4 – Poll Transaction (MBF) Events
:keywords: add_keywords_separated_by_commas
:imagesdir: images
:toc: macro
:toclevels: 2

////
toc::[]
////

== Introduction

The _PortX JDE Connector_ leverages the internal capabilities of Oracle’s _JD Edwards EnterpriseOne™_ solution and uses the power of Oracle’s Java Dynamic Connector to provide interoperability with _JD Edwards EnterpriseOne™_ and external systems.

The following guide explains how to poll for transaction (Master Business Function) events created on the server.

The _PortX JDE Connector_ allows you to discover functions by name, providing full access to all Business Function signatures. The Connector manages a cache repository for all function’s metadata used at least once.

The results of a function call are injected into the flow as a Map containing key-value pairs with the invocation’s output values. This approach allows you to construct complex flows and manage custom exception strategies.

Furthermore, you can have all functions in the flow, processing within the same transaction, and commit or rollback all changes.

=== Prerequisites

A basic understanding of Oracle’s _JD Edwards EnterpriseOne™_, Mule, the and the https://docs.mulesoft.com/anypoint-studio/v/6/download-and-launch-anypoint-studio[Anypoint™ Studio] interface is assumed.

=== Requirements

Review the link:/[PortX JDE Connector for Mule 4 – Getting Started Guide] for a detailed list of requirements and setup prerequisites.

JDE outbound transactions require that you set a _Processing Option_ specifying a transaction type. Additionally, some entry programs enable you to specify a version of the Master Business Function Processing Options program that, in turn, enables you to specify a version of the Interoperability Processing Options program.

To enter a customer using the application *Customer Master Information (P03013)* setup processing options to enable interoperability. 

. log into *JDE*, and change the processing options for this application. 

. Determine which version of the Master Business Function is being called by the application.

To start, review the following processing options.

image:demo_poll_mbf_events/image1_demo_poll_mbf_events.png[image,width=601,height=332]

image:demo_poll_mbf_events/image2_demo_poll_mbf_events.png[image,width=601,height=347]

The Customer Master Business Function version that is used for the application is *ZJDE0002*.

Review the Customer Master MBF (*P0100042*) processing options.

image:demo_poll_mbf_events/image3_demo_poll_mbf_events.png[image,width=601,height=314]

image:demo_poll_mbf_events/image4_demo_poll_mbf_events.png[image,width=601,height=381]

If the *Transaction Type* is not set, set it to the appropriate value.

For more information on setting transaction types, please refer to the _Oracle JD Edwards EnterpriseOne_ documentation.

== Poll Transaction (MBF) Events

NOTE: Ensure you are running the most recently updated version of AnyPoint Studio before starting with a _PortX JDE Connector_ project.

=== Creating a New Mule Project 

Create a new Mule Project with Mule Server 4.1.1 EE or greater as your runtime.

image:demo_poll_mbf_events/image5_demo_poll_mbf_events.png[image,width=321,height=423]

=== Project Dependencies

. In your *pom.xml* add the following to you *Repositories* section :
[source,xml]
----
<repository>
    <id>portx-repository-releases</id>
    <name>portx-repository-releases</name>
    <url>https://portx.jfrog.io/portx/portx-releases</url>
</repository>
----

[start=2]

. Add the following to your *Dependencies* section :

[source,xml]
----
<dependency>
<groupId>com.modus</groupId>
    <artifactId>mule-jde-connector</artifactId>
    <version>2.0.0</version>
    <classifier>mule-plugin</classifier>
</dependency>
<dependency>
    <groupId>com.jdedwards</groupId>
    <artifactId>jde-lib-bundle</artifactId>
    <version>1.0.0</version>
    <classifier>mule-4</classifier>
</dependency>
----
[start=3]

. Add or update the following to your *Plugins* section :
[source,xml]
----
<plugin>
    <groupId>org.mule.tools.maven</groupId>
    <artifactId>mule-maven-plugin</artifactId>
    <version>$\{mule.maven.plugin.version}</version>
    <extensions>true</extensions>
    <configuration>
        <sharedLibraries>
            <sharedLibrary>
                <groupId>com.jdedwards</groupId>
                <artifactId>jde-lib-bundle</artifactId>
            </sharedLibrary>
        </sharedLibraries>
    </configuration>
</plugin>
----

=== Required files

Copy the _JD Edwards EntrpriseOne™_ configuration files to the following folders within the project:

* Project *Root*
* *_src/main/resources_*

NOTE: If there is a requirement to use different configuration files per environment, you may create separate folders under _src/main/resources_ corresponding to each environment as shown below.

image:demo_poll_mbf_events/image6_demo_poll_mbf_events.png[image,width=250,height=446]

The *mule-arifact.json* file must be updated per environment as follows.

[source,json]
----
{
	"minMuleVersion": "4.1.4",
	"classLoaderModelLoaderDescriptor": {
		"id": "mule",
		"attributes": {
			"exportedResources": [
				"JDV920/jdeinterop.ini",
				"JDV920/jdbj.ini",
				"JDV920/tnsnames.ora",
				"JPY920/jdeinterop.ini",
				"JPY920/jdbj.ini",
				"JPY920/tnsnames.ora",
				"jdelog.properties",
				"log4j2.xml"
			],
			"exportedPackages": [
				"JDV920",
				"JPY920"
			],
			"includeTestDependencies": "true"
		}
	}
}
----

=== Other Considerations

To redirect the _JD Edwards EntrpriseOne™_ Logger to Mule Logger (allowing you to see the JDE activity in both Console and JDE files defined in the *jdelog.properties*), add the following *Async Loggers* to *log4j2.xml* file.

[source,xml]
<!-- JDE Connector wire logging -->
<AsyncLogger name="org.mule.modules.jde.handle.MuleHandler" level="INFO" />
<AsyncLogger name="org.mule.modules.jde.JDEConnector" level="INFO" />

=== Troubleshooting

If you are having trouble resolving all dependencies,

. Shut down AnyPoint Studio.
. Run the following command in the project *ROOT* folder from the terminal/command prompt.

[source]
mvn clean install

[start=3]
. Open AnyPoint Studio and check your dependencies again.

=== Configure the Global Element

To use the _PortX JDE Connector_ in your Mule application, you must configure a global element that can be used by the connector.

. Open the Mule flow for your project and select the *Global Elements* tab at the bottom of the Editor Window.

image:demo_poll_mbf_events/image7_demo_poll_mbf_events.png[image,width=515,height=273]

[start=2]

. Click *Create*.

image:demo_poll_mbf_events/image8_demo_poll_mbf_events.png[image,width=511,height=312]

[start=3]

. Type *JDE* in the filter edit box and select *JDE Config*.
. Click *OK*.

image:demo_poll_mbf_events/image9_demo_poll_mbf_events.png[image,width=386,height=390]

[start=5]

. On the *General* tab, enter the required credential and environment.

image:demo_poll_mbf_events/image10_demo_poll_mbf_events.png[image,width=378,height=383]

[start=6]

. Click *Test Connection*.

The following message appears.

image:demo_poll_mbf_events/image11_demo_poll_mbf_events.png[image,width=513,height=135]

You are ready to start using the _PortX JDE Connector_ in your project.

=== Creating a Scheduler for Your Flow

This use case example creates a simple flow to poll for outbound events coming from an application that uses a *Customer Master Business Function* to generate transactions, and write these to files.

See <<Requirements>> for setup details.

. Go to the *Message Flow* tab.

image:demo_poll_mbf_events/image12_demo_poll_mbf_events.png[image,width=601,height=488]

[start=2]

. From the Mule Palette (top right), select *Scheduler* and drag it to the canvas.

image:demo_poll_mbf_events/image13_demo_poll_mbf_events.png[image,width=295,height=278]

[start=3]

. Select the *Scheduler* component from the canvas and inspect the properties window.
. Change the *Frequency* to *2min*.

image:demo_poll_mbf_events/image14_demo_poll_mbf_events.png[image,width=569,height=268]

=== Poll for Transaction (MBF) Events

. Locate the _JDE Connector_ and select *Poll Events*. 
. Drag this to the canvas.

image:demo_poll_mbf_events/image15_demo_poll_mbf_events.png[image,width=190,height=187]

[start=3]

. Drag the connector over to the canvas. 
. Select it and review the properties window.
. Give it a meaningful name (eg. Call _Poll Customer Master Events_).

image:demo_poll_mbf_events/image16_demo_poll_mbf_events.png[image,width=601,height=290]

[start=6]

. Under the *General* section, click the drop-down for *Operation Name*.
. Select *Capture Event Transactions*.

image:demo_poll_mbf_events/image17_demo_poll_mbf_events.png[image,width=601,height=294]

[start=8]

. Assign the input parameters by either entering the payload values manually, or via the *Show Graphical View* button.

image:demo_poll_mbf_events/image18_demo_poll_mbf_events.png[image,width=601,height=294]
[start=9]

. Drag the inputs to outputs, or double-click the *output parameter* to add to your edit window and change as required.

image:demo_poll_mbf_events/image19_demo_poll_mbf_events.png[image,width=601,height=212]

=== Troubleshooting
If the operation fails (possibly due to a timeout), the following message appears.

image:demo_poll_mbf_events/troubleshoot_timeout_message.png[image,width=345,height=115]

Review the *Timeout* settings in _Anypoint Studio_'s *Preferences*.

. Go to *Window > Preferences* menu.

image:demo_poll_mbf_events/troubleshoot_preferences_menu.png[image,width=154,height=199]

[start=2] 

. Go to *Anypoint Studio > DataSense* and change the *DataSense Connection Timeout* setting as demonstrated below.

image:demo_poll_mbf_events/troubleshoot_datasense_timeout.png[image,width=622,height=551]

[start=3]

. Go to *Anypoint Studio > Tooling* and change the *Default Connection Timeout* and *Default Read Timeout* settings as demonstrated below.

image:demo_poll_mbf_events/troubleshoot_timeout_tooling.png[image,width=622,height=551]

=== Set Payload Output

. In the Mule Palette, you can either select *Core*, scroll down to *Transformers* or type *Payload* in the search bar.

image:demo_poll_mbf_events/image20_demo_poll_mbf_events.png[image,width=277,height=209]

[start=2]

. Drag and drop the *Set Payload* to your canvas.

image:demo_poll_mbf_events/image21_demo_poll_mbf_events.png[image,width=360,height=175]

[start=3]

. Select the *Set Payload* component and review the *Properties*.

image:demo_poll_mbf_events/image22_demo_poll_mbf_events.png[image,width=601,height=157]

[start=4]

. Change the payload to reflect the desired output and save the project.

image:demo_poll_mbf_events/image23_demo_poll_mbf_events.png[image,width=601,height=245]

[start=5]

. On the *MIME Type* tab, select *application/xml*.

image:demo_poll_mbf_events/image24_demo_poll_mbf_events.png[image,width=399,height=216]

Check that Transactions are polled and exist. 

. From the Mule Palette, select and drag the *Choice* component.

image:demo_poll_mbf_events/image25_demo_poll_mbf_events.png[image,width=344,height=255]

image:demo_poll_mbf_events/image26_demo_poll_mbf_events.png[image,width=578,height=258]

[start=2]

. Select the *When* statement and review the properties.
. Enter the following expression to check that transactions exist.

image:demo_poll_mbf_events/image27_demo_poll_mbf_events.png[image,width=545,height=170]

Check to see if the Scheduler did not return transactions.

. Add a logger to the *Default* condition. 

. From you Mule Palette, drag the *logger component* to the canvas.

image:demo_poll_mbf_events/image28_demo_poll_mbf_events.png[image,width=306,height=254]

[start=3]

. Select and review the properties and enter an appropriate message.

image:demo_poll_mbf_events/image29_demo_poll_mbf_events.png[image,width=601,height=529]

If transactions are retrieved (*When* condition is true), iterate over all transactions that have been retrieved.

. Drag the *For Each* component from the palette to your canvas.

image:demo_poll_mbf_events/image30_demo_poll_mbf_events.png[image,width=207,height=259]

[start=2] 

. Select the *Component* and review the *Properties*.

image:demo_poll_mbf_events/image31_demo_poll_mbf_events.png[image,width=601,height=251]

[start=3]

. In *Collection*, enter the *Transaction Collection* as demonstrated below.

image:demo_poll_mbf_events/image32_demo_poll_mbf_events.png[image,width=542,height=265]

[start=4]

. Drag the *Set Variable* component to your canvas.
. Select and review the *Properties*.

image:demo_poll_mbf_events/image33_demo_poll_mbf_events.png[image,width=601,height=283]

[start=5]

. Set the *Variable Name*.
. Click *Show Graphical View*.

image:demo_poll_mbf_events/image34_demo_poll_mbf_events.png[image,width=601,height=236]

[start=7]

. Set the *Variable Value* to the *filename* you want to create.
. Click *Done*.

image:demo_poll_mbf_events/image35_demo_poll_mbf_events.png[image,width=601,height=149]

[start=7]

. From your Mule Palette, select the *File > Write* component and drag it to the canvas.

image:demo_poll_mbf_events/image36_demo_poll_mbf_events.png[image,width=298,height=268]

image:demo_poll_mbf_events/image37_demo_poll_mbf_events.png[image,width=601,height=252]

[start=8]

. Select and review the *Properties*.

. Under the *Basic Settings*, click the *Add* button next to *Connector Configuration*.

image:demo_poll_mbf_events/image38_demo_poll_mbf_events.png[image,width=601,height=294]

[start=10]

. In the *Working Directory* field, enter the path where you want to write your file to.
. Click *OK*.

image:demo_poll_mbf_events/image39_demo_poll_mbf_events.png[image,width=601,height=607]

[start=11]

. Under the *General* section, click the *Switch to Expression* button and enter the *Variable Name*.

image:demo_poll_mbf_events/image40_demo_poll_mbf_events.png[image,width=596,height=292]

=== Testing the Mule Flow

To test your flow, start the Mule Application.

. Go to the *Run menu* and select *Run*.

image:demo_poll_mbf_events/image41_demo_poll_mbf_events.png[image,width=567,height=376]

After your project is deployed, you can test you flow by logging into JDE.

. Go to the *Customer Master Information* Application (P03013 ZJDE0002).

NOTE: This must be a version that is configured for interoperability (See <<Requirements>>)

image:demo_poll_mbf_events/image42_demo_poll_mbf_events.png[image,width=601,height=430]

[start=2]

. Make a change to the *customer* and check your output path for a created file.

image:demo_poll_mbf_events/image43_demo_poll_mbf_events.png[image,width=601,height=98]

The *Transaction XML* is written to the file.

image:demo_poll_mbf_events/image44_demo_poll_mbf_events.png[image,width=315,height=280]

=== Handling Exceptions

. From your Mule Pallete, select and drag the *Error Handler* to your canvas. 

image:demo_poll_mbf_events/image45_demo_poll_mbf_events.png[image,width=294,height=334]

image:demo_poll_mbf_events/image46_demo_poll_mbf_events.png[image,width=601,height=424]

[start=2]

. Select and drag *On Error Continue* into the *Error Handler*.

image:demo_poll_mbf_events/image47_demo_poll_mbf_events.png[image,width=247,height=129]

[start=3]

. Select the *On Error Continue* scope, and under *Type* enter *JDE:ERROR_PROCESSING_POLL_EVENT*.

image:demo_poll_mbf_events/image48_demo_poll_mbf_events.png[image,width=447,height=324]

NOTE: The operation error types can be seen when selecting the operation on your canvas by going to *Error Mapping* and clicking *add*. You may also map this error to an application specific error.

image:demo_poll_mbf_events/image49_demo_poll_mbf_events.png[image,width=250,height=291]

[start=4]

. Drag the *Set Payload* component to the *Error Handler* and set an appropriate message.

image:demo_poll_mbf_events/image50_demo_poll_mbf_events.png[image,width=442,height=298]

== PortX JDE Connector – Example Projects

=== Additional Examples

. <<jde.adoc#,Invoke a Business Function>>
. <<demo_ube.adoc#,Submit a Batch Process>> 
. <<demo_ube_status.adoc#,Retrieve a Batch Process’s Status>>
. <<demo_poll_edi_events.adoc#,Poll EDI Events>>