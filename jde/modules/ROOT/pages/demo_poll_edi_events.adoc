= *PortX JD Edwards Connector for Mule 4 – Demo – Poll EDI Events*
:keywords: add_keywords_separated_by_commas
:imagesdir: images
:toc: macro
:toclevels: 2

toc::[]

== Introduction

The _PortX JDE Connector_ leverages the internal capabilities of Oracle’s _JD Edwards EnterpriseOne™_ solution and uses the power of Oracle’s _Java Dynamic Connector_ to provide interoperability with _JD Edwards EnterpriseOne™_ and external systems.

The following guide explains how to poll for EDI Events created on the EnterpriseOne server.

The _PortX JDE Connector_ allows you to discover functions by name, providing full access to all Business Function signatures. The Connector manages a cache repository for all function’s metadata used at least once.

The results of a function call are injected into the flow as a Map containing key-value pairs with the invocation’s output values. This approach allows you to construct complex flows and manage custom exception strategies.


Furthermore, you can have all functions in the flow, processing within the same transaction, and commit or rollback all changes.

=== Prerequisites

A basic understanding of Oracle’s _JD Edwards EnterpriseOne™_, Mule, the and the https://docs.mulesoft.com/anypoint-studio/v/6/download-and-launch-anypoint-studio[Anypoint™ Studio] interface is assumed.

=== Requirements

Review the link:/[PortX JDE Connector for Mule 4 – Getting Started Guide] for a detailed list of requirements and setup prerequisites.

See the link:/https://docs.oracle.com/cd/E64610_01/EOADI/title.htm[JD Edwards EnterpriseOne Applications Data Interface for Electronic Data Interchange Implementation Guide] for more information.

JDE outbound transactions require that you set a _Processing Option_ specifying EDI information.

The following is an example:

To Generate an Order Acknowledgment (*855/ORDSP*) document, you  must setup its processing options to enable interoperability. 

. Log into JDE, and change the processing options for this application. 

. Determine which version of the Print Invoices (*R42565*) is being used. 
. Review the processing options.

image:demo_poll_edi_events/image1_demo_poll_edi_events.png[image,width=482,height=437]

image:demo_poll_edi_events/image2_demo_poll_edi_events.png[image,width=478,height=455]

The last configuration that is needed is inform to JDE connector the EDI outbound:

. Using Flat File Cross-Reference (*P47002*) form, the *Work With Flat File Cross-Reference* adds the following record:

image:demo_poll_edi_events/image3_demo_poll_edi_events.png[image,width=601,height=312]

[cols=",,",options="header",]
|===
|*Table* |*Record Type* |*Type Description*
|F47026 |1 |Header
|F47027 |2 |Detail
|F4706 |6 |Address
|F4714 |7 |Header Text
|F4715 |8 |Detail Text
|===

Refer to the link:https://docs.oracle.com/cd/E64610_01/index.htm[_Oracle JD Edwards EnterpriseOne_] documentation for more information.

== Poll EDI Events

NOTE: Update AnyPoint Studio before starting with a _PortX JDE Connector_ project.

=== Creating a New Mule Project 

Create a new Mule project with Mule Server 4.1.1 EE or greater as runtime:

image:demo_poll_edi_events/image4_demo_poll_edi_events.png[image,width=345,height=463]

=== Project Dependencies

. In your *pom.xml* file, add the following to you *repositories section*.
[source,xml]
----
<repository>
    <id>portx-repository-releases</id>
    <name>portx-repository-releases</name>
    <url>https://portx.jfrog.io/portx/portx-releases</url>
</repository>
----
[start=2]
. Add the following to you *dependencies* section.

[source,xml]
----
<dependency>
<groupId>com.modus</groupId>
    <artifactId>mule-jde-connector</artifactId>
    <version>2.0.0</version>
    <classifier>mule-plugin</classifier>
</dependency>
<dependency>
    <groupId>com.jdedwards</groupId>
    <artifactId>jde-lib-bundle</artifactId>
    <version>1.0.0</version>
    <classifier>mule-4</classifier>
</dependency>
----
[start=3]

. Add or update the following to you *plugins* section.
[source,xml]
----
<plugin>
    <groupId>org.mule.tools.maven</groupId>
    <artifactId>mule-maven-plugin</artifactId>
    <version>$\{mule.maven.plugin.version}</version>
    <extensions>true</extensions>
    <configuration>
        <sharedLibraries>
            <sharedLibrary>
                <groupId>com.jdedwards</groupId>
                <artifactId>jde-lib-bundle</artifactId>
            </sharedLibrary>
        </sharedLibraries>
    </configuration>
</plugin>
----

=== Required files

Copy your _JD Edwards EntrpriseOne™_ configuration files to the following folders within your project.

* Project *Root*
* *_src/main/resources_*

NOTE: If the requirement is to use different configuration files per environment, you may create separate folders under _src/main/resources_ corresponding to each environment as shown below.

image:demo_poll_edi_events/image5_demo_poll_edi_events.png[image,width=250,height=446]

The *mule-arifact.json* file needs to be updated per environment as shown below.

[source,json]
----
{
	"minMuleVersion": "4.1.4",
	"classLoaderModelLoaderDescriptor": {
		"id": "mule",
		"attributes": {
			"exportedResources": [
				"JDV920/jdeinterop.ini",
				"JDV920/jdbj.ini",
				"JDV920/tnsnames.ora",
				"JPY920/jdeinterop.ini",
				"JPY920/jdbj.ini",
				"JPY920/tnsnames.ora",
				"jdelog.properties",
				"log4j2.xml"
			],
			"exportedPackages": [
				"JDV920",
				"JPY920"
			],
			"includeTestDependencies": "true"
		}
	}
}
----

=== Other Considerations

To redirect the _JD Edwards EntrpriseOne™_ Logger to the Mule Logger (to see JDE activity in both consoles and JDE files defined in the *jdelog.properties*), you may add the following _Async Loggers_ to *log4j2.xml* file.

[source,xml]
<!-- JDE Connector wire logging -->
<AsyncLogger name="org.mule.modules.jde.handle.MuleHandler" level="INFO" />
<AsyncLogger name="org.mule.modules.jde.JDEConnector" level="INFO" />

=== Troubleshooting

If you are having trouble resolving all dependencies,

. Shut down AnyPoint Studio
. Run the following command in the project root folder from the terminal/command prompt,

_mvn clean install_

[start=3]
. Open AnyPoint Studio and check dependencies again.

=== Configure the Global Element

To use the _PortX JDE Connector_ in your Mule application, you must configure a global element that can be used by the connector.

. Open the Mule flow for the project, and select the *Global Elements* tab at the bottom of the Editor Window.

image:demo_poll_edi_events/image6_demo_poll_edi_events.png[image,width=515,height=273]

[start=2]

. Click *Create*.

image:demo_poll_edi_events/image7_demo_poll_edi_events.png[image,width=511,height=312]

[start=3]

. Type *JDE* in the filter edit box, and select *JDE Config*.
. Click *OK*.

image:demo_poll_edi_events/image8_demo_poll_edi_events.png[image,width=386,height=390]

[start=4]

. On the *General* tab, enter the required credential and environment.

image:demo_poll_edi_events/image9_demo_poll_edi_events.png[image,width=378,height=383]

[start=5]

. Click *Test Connection*.

The following message appears.

image:demo_poll_edi_events/image10_demo_poll_edi_events.png[image,width=513,height=135]

You are now ready to start using the _PortX JDE Connector_ in your project.

=== Creating a Scheduler for Your Flow

This use case example create a simple flow to poll for outbound events coming from an application that uses *Print Invoices* (*R42565*) to generate a *Order Acknowledgement (855/ORDSP)* EDI document, and write these to files.

See <<Requirements>> setup details.

. Go to the *Message Flow* tab.

image:demo_poll_edi_events/image11_demo_poll_edi_events.png[image,width=601,height=457]

[start=2]

. From the Mule Palette (top right), select *Scheduler*, and drag it to the canvas.

image:demo_poll_edi_events/image12_demo_poll_edi_events.png[image,width=295,height=278]

[start=2]

. Select the *Scheduler* component from the canvas, and inspect the properties window, and change the Frequency to *2min*.

image:demo_poll_edi_events/image13_demo_poll_edi_events.png[image,width=498,height=336]

=== Poll for EDI Events

. Locate the *JDE* Connector, and select *Edi outbound*.
. Drag this to the canvas.

image:demo_poll_edi_events/image14_demo_poll_edi_events.png[image,width=221,height=191]

[start=3]

. Drag the connector over to the canvas. 
. Select the connector and review the properties window.
. Give it a meaningful name (eg. Call _Poll Order Acknowledgement EDI_).

image:demo_poll_edi_events/image15_demo_poll_edi_events.png[image,width=410,height=258]

[start=6]

. Under the *General* section, click the drop-down for *Operation Name*, and select *Capture EDI Transactions*.

image:demo_poll_edi_events/image16_demo_poll_edi_events.png[image,width=589,height=302]

=== Troubleshooting
If the operation fails (possibly due to a timeout), the following message appears.

image:demo_poll_edi_events/troubleshoot_timeout_message.png[image,width=345,height=115]

Review the *timeout* settings in _Anypoint Studio_'s *Preferences*.

. Go the the *Window > Preferences* menu.

image:demo_poll_edi_events/troubleshoot_preferences_menu.png[image,width=154,height=199]

[start=2]

. Go to *Anypoint Studio > DataSense* and change the *DataSense Connection Timeout* setting as shown below.

image:demo_poll_edi_events/troubleshoot_datasense_timeout.png[image,width=622,height=551]

[start=3]

. Go to *Anypoint Studio > Tooling* and change the *Default Connection Timeout* and *Default Read Timeout* settings as shown below.

image:demo_poll_edi_events/troubleshoot_timeout_tooling.png[image,width=622,height=551]

=== Setting Parameters

. Assign the input parameters, by either entering the payload values manually, or via the *Show Graphical View* button.

image:demo_poll_edi_events/image17_demo_poll_edi_events.png[image,width=601,height=292]
[start=2]

. Drag the inputs to outputs, or double-click the output parameter to add to your edit window, and change as required.

image:demo_poll_edi_events/image18_demo_poll_edi_events.png[image,width=601,height=179]

=== Set Payload Output

. In the Mule Palette, either select *Core*, scroll down to *Transformers* or type *Payload* in the search bar.

image:demo_poll_edi_events/image19_demo_poll_edi_events.png[image,width=277,height=209]

[start=2]

. Drag and drop the *Set Payload* to your canvas.

image:demo_poll_edi_events/image20_demo_poll_edi_events.png[image,width=365,height=192]

[start=3]

. Select the *Set Payload* component, and review the properties.

image:demo_poll_edi_events/image21_demo_poll_edi_events.png[image,width=601,height=157]
[start=4]

. Change the *Payload* to reflect the desired output, and save your project.

image:demo_poll_edi_events/image22_demo_poll_edi_events.png[image,width=601,height=216]

[start=5]

. On the *MIME Type* tab, select *application/xml*.

image:demo_poll_edi_events/image23_demo_poll_edi_events.png[image,width=399,height=216]


Check that the Transactions were polled. 

. From the Mule Palette, select and drag the *Choice* component.

image:demo_poll_edi_events/image24_demo_poll_edi_events.png[image,width=344,height=255]

image:demo_poll_edi_events/image25_demo_poll_edi_events.png[image,width=600,height=259]

[start=2]

. Select the *When* statement, and review the properties.
. Enter the following expression to check that the transactions exist.

image:demo_poll_edi_events/image26_demo_poll_edi_events.png[image,width=545,height=170]

Check to see when the Scheduler returned no transactions.
Add a logger to the *Default* condition. 

. From you Mule Palette, drag the *logger* component to the canvas.

image:demo_poll_edi_events/image27_demo_poll_edi_events.png[image,width=306,height=254]

[start=2]

. Select and review the properties, and enter an appropriate message.

image:demo_poll_edi_events/image28_demo_poll_edi_events.png[image,width=601,height=520]

If transactions are retrieved (*When* condition is true), iterate over all transactions that are retrieved.

. Drag the *For Each* component from the *out* palette, to your canvas.

image:demo_poll_edi_events/image29_demo_poll_edi_events.png[image,width=207,height=259]

[start=2]

. Select the component, and review the properties.

image:demo_poll_edi_events/image30_demo_poll_edi_events.png[image,width=601,height=265]

[start=3]

. In *Collection* enter the *Transaction Collection* as shown below.

image:demo_poll_edi_events/image31_demo_poll_edi_events.png[image,width=542,height=265]

[start=4]

. Drag the *Set Variable* component to your canvas.
. Select and review the properties.

image:demo_poll_edi_events/image32_demo_poll_edi_events.png[image,width=601,height=274]

[start=5]

. Set the *Variable Name*.
. Click *Show Graphical View*.

image:demo_poll_edi_events/image33_demo_poll_edi_events.png[image,width=601,height=236]

[start=6]

. Set the *Variable* value to the filename you want to create.
. Click *Done*.

image:demo_poll_edi_events/image34_demo_poll_edi_events.png[image,width=600,height=194]

[start=8]

. From your Mule Palette, drag the *X12 EDI > Write* component to your canvas.

NOTE: If you do not have *X12 EDI> Write* component, must download it from _AnyPoint Exchange_.

image:demo_poll_edi_events/image35_demo_poll_edi_events.png[image,width=274,height=225]

[start=9]

. Review your component.
. Create a Connector Configuration by clicking the *Add* button.

image:demo_poll_edi_events/image36_demo_poll_edi_events.png[image,width=601,height=225]

Change schema definitions to *inline*.

. Click *Add* and enter the required schema (this points to a schema file).

NOTE: Download schema if you do not have it.

image:demo_poll_edi_events/image37_demo_poll_edi_events.png[image,width=344,height=348]

[start=2]

. On the *Identity* Tab, enter the details as required.
. Click *OK*

image:demo_poll_edi_events/image38_demo_poll_edi_events.png[image,width=351,height=356]

[start=4]

. Click the *Show Graphical View* button.

image:demo_poll_edi_events/image39_demo_poll_edi_events.png[image,width=601,height=226]

[start=5]

. Enter the *Payload* as required.

[source,json]
%dw 2.0
output application/java
---
{
	Interchange: {
		ISA01: "00",
		ISA03: "00",
		ISA05: "ZZ",
		ISA06: "Modusbox",
		ISA07: "ZZ",
		ISA08: "Customer",
		ISA09: now,
		ISA10: now,
		ISA11: "^",
		ISA12: "00501",
		ISA13: payload.TRANSACTION.COLUMN_EDOC,
		ISA14: "0",
		ISA15: "P",
		ISA16: ">"
	},
	Group: {
        GS01: "PR",
        GS02: "DEMO",
        GS03: "PARTNER",
        GS04: now,
        GS05: now,
        GS06: 1111,
        GS07: "X",
        GS08: "005010"
	},
	SetHeader: {
        ST01: "855",
        ST02: "530006100"
	},
    Heading: {
	    "0200_BAK": {
	            BAK01: "00",
	            BAK02: "AD",
	            BAK03: "PO01",
	            BAK04: now
            		}
	},
	Detail: {
		"0100_PO1_Loop": payload.TRANSACTION.TABLE_2.FORMAT_TABLE_F47027 
					map ((FORMAT_TABLE_F47027 , index) -> 
						{
                        "0100_PO1": {
                                PO102: FORMAT_TABLE_F47027.COLUMN_UORG as Number,
                                PO103: FORMAT_TABLE_F47027.COLUMN_UOM,
                                PO104: FORMAT_TABLE_F47027.COLUMN_UPRC as Number,
                                PO105: "CP",
                                PO106: "CB",
                                PO107: FORMAT_TABLE_F47027.COLUMN_LITM as String
                        },
                        "0500_PID_Loop": [{
                                "0500_PID": {
                                        PID01: "F",
                                        PID05: FORMAT_TABLE_F47027.COLUMN_DSC1 replace /,/ with ""
                                }
                        }]
                })
        },
        Summary: {
                "0100_CTT_Loop": {
                        "0100_CTT": {
                                CTT01: sizeOf(payload.TRANSACTION.TABLE_2.FORMAT_TABLE_F47027) ,
                                CTT02: 1
                        }
                }
        }
}

[start=6]

. From your Mule Palette, Select the *File > Write* component, and drag it to your canvas.

image:demo_poll_edi_events/image40_demo_poll_edi_events.png[image,width=298,height=268]

image:demo_poll_edi_events/image41_demo_poll_edi_events.png[image,width=601,height=252]

Select and review the *Properties*.

. Under the *Basic Settings*, click the *Add* button next to *Connector Configuration*.

image:demo_poll_edi_events/image42_demo_poll_edi_events.png[image,width=601,height=294]

[start=2]

. In the *Working* Directory field, enter the path where you want to write the file to.
. Click *OK*.

image:demo_poll_edi_events/image43_demo_poll_edi_events.png[image,width=601,height=607]

[start=4]

. Under the *General* section, click the *Switch to Expression* button.
. Enter the *Variable Name*.

image:demo_poll_edi_events/image44_demo_poll_edi_events.png[image,width=596,height=292]

=== Testing the Mule Flow

To test your flow, start the Mule application. 

. Go to the *Run* menu, and select *Run*.

image:demo_poll_edi_events/image45_demo_poll_edi_events.png[image,width=567,height=376]

[start=2]

. After your project is deployed, log into _JDE_.

. Go to the *Customer Master Information* Application (*P03013 ZJDE0002*)

NOTE: Use a version of JDE that is configured for interoperability. 
See <<Requirements>> for more information.

image:demo_poll_edi_events/image46_demo_poll_edi_events.png[image,width=601,height=430]

[start=2]

. Make a change to the customer, and check your output path for a created file.

image:demo_poll_edi_events/image47_demo_poll_edi_events.png[image,width=601,height=98]

The *Transaction XML* is written to the file.

image:demo_poll_edi_events/image48_demo_poll_edi_events.png[image,width=315,height=280]

=== Handling Exceptions

. From your Mule Pallete, select and drag the *Error Handler* to your canvas.

image:demo_poll_edi_events/image49_demo_poll_edi_events.png[image,width=294,height=334]

image:demo_poll_edi_events/image50_demo_poll_edi_events.png[image,width=601,height=424]

[start=2]

. Select and drag *On Error Continue* into the *Error Handler*.

image:demo_poll_edi_events/image51_demo_poll_edi_events.png[image,width=247,height=129]

[start=3]

. Select the *On Error Continue* scope, and under *Type* enter JDE:ERROR_PROCESSING_POLL_EVENT.

image:demo_poll_edi_events/image52_demo_poll_edi_events.png[image,width=447,height=324]

NOTE: Operation error types are visable when you select the operation on your canvas by going to *Error Mapping*, and clicking *Add*. You may also map this error to an application specific error.

image:demo_poll_edi_events/image53_demo_poll_edi_events.png[image,width=250,height=291]

[start=4]

. Drag the *Set Payload* component to the *Error Handler*, and set an appropriate message.

image:demo_poll_edi_events/image54_demo_poll_edi_events.png[image,width=442,height=298]

== PortX JDE Connector – Demo Projects

=== Additional Examples

* <<jde.adoc#,Invoke a Business Function>>
* <<demo_ube.adoc#,Submit a Batch Process>> 
* <<demo_ube_status.adoc#,Retrieve a Batch Process’s Status>>
* <<demo_poll_mbf_events.adoc#,Poll MBF Events>>