= AS2 Connector 2.0.0
:keywords: b2b, as2, connector

The https://www.anypoint.mulesoft.com/exchange/?search=as2[AS2 Connector] allows you to send and receive data from AS2 certified servers.

This guide provides instructions to accomplish the following:

* <<Installation>> of the AS2 Connector.
* Building an <<Example Use Case - Hello World>> project.
* Running the example project.

== Requirements 
A familiar understanding of Mule and Anypoint Studio is assumed.

* Mule 3.5.2, 3.6.1 or 3.7.2 Runtime
* Anypoint Studio 2015 onwards
* link:http://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html[JCE unlimited strength jurisdiction policy]

=== Namespace and Schema Location
To use the AS2 Connector you need the following XLM _namespace_ and _schema_ location.

----
xmlns:as2="http://www.mulesoft.org/schema/mule/as2"

http://xsischemaLocation=[xsi:schemaLocation=]"

...

http://www.mulesoft.org/schema/mule/as2 http://www.mulesoft.org/schema/mule/as2/current/mule-as2.xsd"
----


== Installation

=== Installing AS2 Connector in Anypoint Studio

. In Anypoint Studio, click the Exchange icon in the Studio taskbar.
. Click Login in Anypoint Exchange.
. Search for the connector and click Install.
. Follow the prompts to install the connector.

NOTE: When Anypoint Studio has an update, a message displays in the lower right corner, which you can click to install the update.

=== Using AS2 Connector via Maven

If you wish to use the AS2 Connector in conjunction with Maven, follow the instructions link:http://modusintegration.github.io/mule-connector-as2/2.0.0/apidocs/guide/install.html[here].


== Use Cases

* Send an AS2 Message
* Receive an AS2 Message
* Signed and/or encrypted and/or compressed AS2 messages
* Signed or unsigned receipts
* Synchronous or asynchronous receipts
* HTTP/HTTPS support

=== Tips

* Pick unique AS2 IDs per connector instance, it will help you track your messages
* Test your trading partner ports and your own are open and reachable
* It is recommended to use port 80 and 443 when possible (avoids mapping firewall rules for each partner)
* When creating certificates, include its expiration date and your AS2 ID in the filename.

=== Adding to a Flow

Using the AS2 Connector in your application is explained in detail in the Example Use Case section below.

== Example Use Case - Hello World
In the following use case example you can:

* <<Receive Any AS2 Message Over HTTP>>
* <<Send a Clear and Unsigned AS2 Message Over HTTP>>

== Receive Any AS2 Message Over HTTP

. Login to Anypoint Studio.
. Create a new Mule Project.
+
The Project Settings Page appears.

image:receive-example-step-1.png[receive-example-step-1] +

[start=3]
. Create your new project with *Mule Server 3.6.0 EE* as runtime.
. Name your project (e.g receive-as2-hello-world)
. Locate your Mule pallet.

image:receive-example-step-2.png[receive-example-step-2]
[start=5]

. Locate the *AS2 Connector* on the right hand-side palette.

. Select the AS2 Connector.
. Drag the AS2 Connector over to the canvas.

image:receive-example-step-3.png[receive-example-step-3]

=== Create Global HTTP Receive Endpoint
The AS2 Connector requires an AS2 Connector Configuration. To create a connector configuration, you must first create a Global HTTP Endpoint and then bind the connector configuration to the endpoint. The connector’s operations leverage the HTTP endpoint to receive and send AS2 messages.


. Click the Global Elements tab.
+
The Choose Global Type Window appears.

image:4+http+global.png[4+http+global]

[start=2]
. Under _Connector Endpoints_, click *HTTP*.
. Click *OK*
+
The Global Element Properties Window appears.

image:5+configure+http.png[5+configure+http]
[start=4]

. Give the HTTP connector a more descriptive name (e.g. *receive-as2-http-endpoint*).
. Click the Connector Configuration add symbol.
+
The HTTP-HTTPS Configuration Window appears.

image:6+as2+http.png[6+as2+http]

[start=6]

. Give the HTTP connector name a more descriptive name (e.g. *as2-http-connector*).
. Click *OK*. 
+
The Global HTTP Endpoint dialog box appears.

image:7+endpoint.png[7+endpoint]
[start=8]

. Click *OK*.

=== Create an AS2 Connector Configuration
. Navagate to the Global Elements view.
+
The Choose Global Type window appears.

image:image2015-6-25-step8-glob-elem.png[image2015-6-25+21%3A7%3A49]

[start=2]
. Select AS2 Configuration.
. Click *OK*.
+
The AS2 Configuration Page appears.


image:image2015-6-25-receive-as2.png[image2015-6-25+21%3A10%3A5]

[start=4]
. Type *receive-as2-http-endpoint* in the attribute Global HTTP Endpoint Reference to bind the AS2 connector to the previously created global HTTP endpoint.
. Click *OK*.
+
The following appears in the Global Elements view.

image:image2015-6-25-step10a.png[image2015-6-25+21%3A11%3A5]

[start=6]

. Navagate to the Message Flow view, on the AS2 message source.

image:image2015-6-25-step10-select-receive.png[image2015-6-25+21%3A13%3A1]
[start=7]

. Select *AS2* from the Connector Configuration drop-down list. 
. Select *Receive* from the Operation drop-down list.

=== Configure the Key Store Path Attribute

The AS2 Connector’s Key Store Path attribute must be configured in the following scenarios:

* Scenario 1: Connector receives a signed request.
* Scenario 2: Connector receives an encrypted request.
* Scenario 3: Sender requests a signed receipt.

IMPORTANT: The key store must be in JKS format. A cross-platform tool that can help you with the setting up of JKS key
stores is http://keystore-explorer.sourceforge.net/[KeyStore Explorer].

IMPORTANT: CloudHub deployments must have key stores located within the Mule application Java classpath (e.g., src/main/resources).
Furthermore, the key store path attribute has to be relative to the classpath. For instance, if the key store is located
at src/main/resources/key-stores/my-key-store.jks, then Key Store Path is set to key-stores/my-key-store.jks.

* *Scenario 1* The key store has to contain the certificate used by the AS2 connector to verify the request’s authenticity.

* *Scenario 2 and 3* require the key store to have a dual-purpose public/private key pair that the connector uses to decrypt
the request and sign the receipt. The key store entry alias name for the certificate is required to match the AS2-From field
received in the request’s headers. Similarly, the key store entry alias name for the public/private key pair is required to match
the AS2-To field received in the request’s headers. The attribute Key Store Password must be set if the key store is protected by a password.
+
To keep this example simple the key stores are not set, so no security is provided by the connector.


=== Add a File Outbound Endpoint

Add a File Outbound Endpoint to save the sender’s AS2 message content. 

. Drag a File outbound endpoint from the palette next to the AS2 Connector.

image:image2015-6-25-step12a.png[image2015-6-25+21%3A15%3A36]
[start=2]

. Set the Path attribute to *inbox* and Output Pattern to *data.txt*.

=== Run the Connector 
Run the example as a Mule application.

. Under Package Explorer select your connector (e.g recieve-as2-hello-world).

image:image2015-6-25-step13a.png[image2015-6-25+21%3A16%3A12]

[start=2]
. In the dropdown menu select *Run As => Mule Application*.

The connector saves the content of valid AS2 messages in the file “data.txt” inside the project root directory “inbox”.

== Send a Clear and Unsigned AS2 Message Over HTTP

. Create a new Mule Project.
+
The Project Settings Page appears.

image:image2015-6-26-step1b.png[image2015-6-26+9%3A7%3A18]

. Create your new project with *Mule Server 3.6.0 EE* as runtime.
. Name your project (e.g *send-as2-hello-world*)
. Click *OK*.
. Drag a *File inbound endpoint* to the canvas to create a message source for a flow. 

image:image2015-6-26-step2b.png[image2015-6-26+9%3A18%3A1]
[start=6]

. Set the Path attribute to *outbox*.

. Locate the AS2 Connector on the right hand-side palette.

image:image2015-6-26-step3b.png[image2015-6-26+9%3A19%3A48]

[start=8]

. Navagate to the canvas.

image:image2015-6-26-step4b.png[image2015-6-26+9%3A21%3A35]

[start=9]
. Drag the connector over to the canvas next to the File message source.

=== Create a Global HTTP Send Endpoint

The connector requires an AS2 Connector Configuration. To create a connector configuration, you must first create a global HTTP endpoint and then bind the connector configuration to the endpoint. The connector’s operations leverage the HTTP transport to receive and send AS2 messages.

. Click the Global Elements tab.
+
The Choose Global Type Window appears.

image:image2015-6-26-step5b.png[image2015-6-26+9%3A23%3A54]

[start=2]
. Under _Connector Endpoints_ click *HTTP*.
. Click *OK*
+
The Global Element Properties Window appears.

image:image2015-6-26-step6b.png[image2015-6-26+9%3A25%3A58]
[start=4]

. Give the endpoint HTTP connector a more descriptive name (e.g.*send-as2-http-endpoint*). 
. Set the _host_, _port_ and _path_ attributes to point to your chosen AS2 receiver. 
. Click on the Connector Configuration add symbol.
+
The HTTP connector configuration dialog box appears.

image:image2015-6-26-step7b.png[image2015-6-26+9%3A36%3A29]

[start=7]

. Give the HTTP connector a more descriptive name (e.g, *as2-http-connector*).
. Click *OK*.
+
The Global HTTP endpoint dialog box appears.

image:image2015-6-26-step8b.png[image2015-6-26+9%3A28%3A33]

Click *OK* to close the Global HTTP endpoint dialog box.

=== Create an AS2 Connector Configuration
Make an AS2 connector configuration and bind it to the global HTTP connector. 

. Navatage to the Global Elements View.
+
The Choose Global Type window appears.

image:image2015-6-25-step8-glob-elem.png[image2015-6-25+21%3A7%3A49]

[start=2]
. Select an AS2 configuration.
. Click *OK*

image:image2015-6-26-step10b.png[image2015-6-26+9%3A31%3A14]

[start=4]

. Type *send-as2-http-endpoint* in the attribute Global HTTP Endpoint Reference to bind the AS2 connector to the global HTTP connector. 
. Click *OK*.

The following appears in the Global Elements view.

image:image2015-6-26-step11b.png[image2015-6-26+9%3A32%3A54]

[start=6]

. Navagate to the Message Flow view, on the AS2 processor.

image:image2015-6-26-step11bb.png[image2015-6-26+9%3A37%3A25]

[start=7]

. Select *AS2* from the Connector Configuration drop-down list.
. Select *Send* from the Operation drop-down list.
. Scroll down to System Identifiers.

image:image2015-6-26-step12b.png[image2015-6-26+9%3A38%3A57]

[start=10]

. Populate the _AS2-From_ and _AS2-To_ attributes. 

NOTE: The AS2-To identifier is typically provided out-of-band by the AS2 receiver.

=== Configure a Key Store Path Attribute

The AS2 Connector’s Key Store Path attribute must be configured in the following scenarios:

* Scenario 1: Connector sends a signed request +
* Scenario 2: Connector sends an encrypted request +
* Scenario 3: Receiver returns a signed receipt

IMPORTANT: The key store must be in JKS format. A cross-platform tool that can help you with the setting up of JKS key
stores is http://keystore-explorer.sourceforge.net/[KeyStore Explorer].

IMPORTANT: CloudHub deployments must have key stores located within the Mule application Java classpath (e.g., src/main/resources).
Furthermore, the key store path attribute has to be relative to the classpath. For instance, if the key store is located
at src/main/resources/key-stores/my-key-store.jks, then Key Store Path is set to key-stores/my-key-store.jks.

* *Scenario 1 and 2* require the key store to have a dual-purpose public/private key pair that the connector uses to encrypt
and sign the request. 

* *Scenario 3* the key store has to contain the certificate used by the AS2 connector to verify the receipt’s authenticity. The key store entry alias name for the public/private key pair is required to match the value set in the _AS2-From_ attribute. Similarly, the key store entry alias name for the certificate is required to match the value set in the _AS2-To_ attribute. The attribute Key Store Password must be set if the key store is protected by a password.
+
To keep this example simple the key stores are not set, so no security is provided by the connector.

=== AS2 Receiver Receipt

Viewing the receipt returned by the AS2 receiver is optional but useful for testing.

. Navagate to your connector (e.g, *send-as2-hello-world*).

image:image2015-6-26-step14.png[image2015-6-26+9%3A41%3A2]
[start=2]

. Append to the flow a *Byte Array to String* transformer followed by a *Logger* processor to print the receipt's content to console.

NOTE: The Logger in the above screenshot has its Message attribute set to *#[payload]*

=== Run the Connector

Run this example as a Mule application:

. Under Package Explorer select your connector (e.g send-as2-hello-world).

image:image2015-6-26-step15.png[image2015-6-26+9%3A41%3A51]

[start=2]

. In the dropdown menu select *Run As ⇒ Mule Application*.
. The receiver's receipt appears in the console.
+
The connector saves the content of valid AS2 messages in the file *data.txt* inside the project root directory *inbox*.
Drop a file in the *outbox* directory to send it to the receiver over AS2. 
